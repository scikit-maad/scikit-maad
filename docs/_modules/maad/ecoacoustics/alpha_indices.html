

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>maad.ecoacoustics.alpha_indices &mdash; scikit-maad 0.1.4 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> scikit-maad
          

          
            
            <img src="../../../_static/logo_maad.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/maad.html">maad</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">scikit-maad</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>maad.ecoacoustics.alpha_indices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for maad.ecoacoustics.alpha_indices</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot; Created on Wed Oct 24 11:56:28 2018</span>
<span class="sd">    Alpha indices used in ecoacoustics</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#</span>
<span class="c1"># Authors:  Juan Sebastian ULLOA &lt;lisofomia@gmail.com&gt;</span>
<span class="c1">#           Sylvain HAUPERT &lt;sylvain.haupert@mnhn.fr&gt;        </span>
<span class="c1">#</span>
<span class="c1"># License: New BSD License</span>

<span class="c1">#***************************************************************************</span>
<span class="c1"># -------------------       Load modules         ---------------------------</span>
<span class="c1">#***************************************************************************</span>

<span class="c1">#### Import external modules</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span>  <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">diff</span>
<span class="kn">import</span> <span class="nn">numbers</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">hilbert</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">binary_erosion</span><span class="p">,</span> <span class="n">binary_dilation</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">rankdata</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1">#### Importation from internal modules</span>
<span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">rle</span><span class="p">,</span> <span class="n">index_bw</span><span class="p">,</span> <span class="n">linear_scale</span><span class="p">,</span> <span class="n">dB2linear</span><span class="p">,</span> <span class="n">linear2dB</span>

<span class="c1"># min value</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">_MIN_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">min</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># List of functions</span>
<span class="c1"># =============================================================================</span>

 
<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="wave2frames"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.wave2frames.html#maad.ecoacoustics.alpha_indices.wave2frames">[docs]</a><span class="k">def</span> <span class="nf">wave2frames</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reshape a sound waveform (ie vector) into a serie of frames (ie matrix) of</span>
<span class="sd">    length N</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : 1d ndarray of floats (already divided by the number of bits)</span>
<span class="sd">        Vector containing the sound waveform </span>

<span class="sd">    N : int, optional, default is 512</span>
<span class="sd">        Number of points per frame</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    timeframes : 2d ndarray of floats</span>
<span class="sd">        Matrix containing K frames (row) with N points (column), K*N &lt;= length (wave)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># transform wave into array</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span>
    <span class="c1"># compute the number of frames</span>
    <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span><span class="o">//</span><span class="n">N</span>
    <span class="c1"># Reshape the waveform (ie vector) into a serie of frames (ie 2D matrix)</span>
    <span class="n">timeframes</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">K</span><span class="o">*</span><span class="n">N</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">timeframes</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="intoBins"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.intoBins.html#maad.ecoacoustics.alpha_indices.intoBins">[docs]</a><span class="k">def</span> <span class="nf">intoBins</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">an</span><span class="p">,</span> <span class="n">bin_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bin_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bin_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    Transform a vector or a matrix into bins </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : array-like</span>
<span class="sd">        1D or 2D array.</span>
<span class="sd">    an :1d ndarray of floats </span>
<span class="sd">        Vector containing the positions of each value. </span>
<span class="sd">        In case of 2D matrix, this vector corresponds to the horizontal (row)</span>
<span class="sd">        or vertical (columns) units</span>
<span class="sd">    bin_step : scalar</span>
<span class="sd">        Determine the width of each bin.</span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        Determine  along which axis the transformation is done.</span>
<span class="sd">        In case of matrix :</span>
<span class="sd">        axis = 0 =&gt; transformation is done on column</span>
<span class="sd">        </span>
<span class="sd">        axis = 1 =&gt; transformation is done on row </span>
<span class="sd">    bin_min : scalar, optional, default is None</span>
<span class="sd">        This minimum value corresponds to the start of the first bin. </span>
<span class="sd">        By default, the minimum value is the first value of an.</span>
<span class="sd">    bin_max : scalar, optional, default is None</span>
<span class="sd">        This maximum value corresponds to end of the last bin. </span>
<span class="sd">        By default, the maximum value is the last value of an.   </span>
<span class="sd">    display : boolean, optional, defualt is False</span>
<span class="sd">        Display the result of the tranformation : an histogram</span>
<span class="sd">        In case of matrix, the mean histogram is shown.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xbins :  array-like</span>
<span class="sd">        1D or 2D array which correspond to the data after being transformed into bins</span>
<span class="sd">    bin : 1d ndarray of floats </span>
<span class="sd">        Vector containing the positions of each bin</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="c1"># Test if the bin_step is larger than the resolution of an</span>
    <span class="k">if</span> <span class="n">bin_step</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">an</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WARNING: bin step must be largero or equal than the actual resolution of x&#39;</span><span class="p">)</span>

    <span class="c1"># In case the limits of the bin are not set</span>
    <span class="k">if</span> <span class="n">bin_min</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bin_min</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">bin_max</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span>
        <span class="n">bin_max</span> <span class="o">=</span> <span class="n">an</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Creation of the bins</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span><span class="n">bin_max</span><span class="o">+</span><span class="n">bin_step</span><span class="p">,</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xbin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">an</span><span class="o">&gt;=</span><span class="n">b0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">an</span><span class="o">&lt;</span><span class="n">b</span><span class="p">)</span> 
        <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">xbin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">indices</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">xbin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span><span class="n">indices</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">b</span>
      
    <span class="n">xbin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xbin</span><span class="p">)</span> <span class="o">*</span> <span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Display</span>
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="c1"># if xbin is a vector</span>
        <span class="k">if</span> <span class="n">xbin</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">xbin</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if xbin is a matrix</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">an</span><span class="p">,</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">mean</span><span class="p">(</span><span class="n">xbin</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">bin_step</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">&#39;edge&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">xbin</span><span class="p">,</span> <span class="n">bins</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="skewness"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.skewness.html#maad.ecoacoustics.alpha_indices.skewness">[docs]</a><span class="k">def</span> <span class="nf">skewness</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcul the skewness (asymetry) of a signal x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats </span>
<span class="sd">        1d signal or 2d matrix</span>
<span class="sd">        </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        select the axis to compute the kurtosis</span>
<span class="sd">                            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ku : float or ndarray of floats</span>
<span class="sd">        skewness of x </span>
<span class="sd">        if x is a 1d vector =&gt; single value</span>
<span class="sd">        if x is a 2d matrix =&gt; array of values corresponding to the number of</span>
<span class="sd">        points in the other axis</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="n">mean_x</span> <span class="o">=</span>  <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">std_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mean_x</span>
        <span class="n">sk</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">std_x</span><span class="o">**</span><span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of x must be ndarray&quot;</span><span class="p">)</span> 
        <span class="n">sk</span> <span class="o">=</span> <span class="kc">None</span>
       
    <span class="k">return</span> <span class="n">sk</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="kurtosis"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.kurtosis.html#maad.ecoacoustics.alpha_indices.kurtosis">[docs]</a><span class="k">def</span> <span class="nf">kurtosis</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcul the kurtosis (tailedness or curved or arching) of a signal x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats </span>
<span class="sd">        1d signal or 2d matrix       </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        select the axis to compute the kurtosis</span>
<span class="sd">                            </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ku : float or ndarray of floats</span>
<span class="sd">        kurtosis of x </span>
<span class="sd">        if x is a 1d vector =&gt; single value</span>
<span class="sd">        if x is a 2d matrix =&gt; array of values corresponding to the number of</span>
<span class="sd">        points in the other axis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
        <span class="n">mean_x</span> <span class="o">=</span>  <span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">std_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">mean_x</span>
        <span class="n">ku</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">Nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">std_x</span><span class="o">**</span><span class="mi">4</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of x must be ndarray&quot;</span><span class="p">)</span> 
        <span class="n">ku</span> <span class="o">=</span> <span class="kc">None</span>
       
    <span class="k">return</span> <span class="n">ku</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="roughness"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.roughness.html#maad.ecoacoustics.alpha_indices.roughness">[docs]</a><span class="k">def</span> <span class="nf">roughness</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the roughness (depends on the number of peaks and their amplitude)</span>
<span class="sd">    of a vector or matrix x (i.e. waveform, spectrogram...)   </span>
<span class="sd">    Roughness = sum(second_derivation(x)Â²)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        x is a vector (1d) or a matrix (2d)</span>
<span class="sd">        </span>
<span class="sd">    norm : boolean, optional. Default is None</span>
<span class="sd">        &#39;global&#39; : normalize by the maximum value in the vector or matrix</span>
<span class="sd">        &#39;per_axis&#39; : normalize by the maximum value found along each axis</span>

<span class="sd">    axis : int, optional, default is 0</span>
<span class="sd">        select the axis where the second derivation is computed</span>
<span class="sd">        if x is a vector, axis=0</span>
<span class="sd">        if x is a 2d ndarray, axis=0 =&gt; rows, axis=1 =&gt; columns</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    y : float or ndarray of floats</span>

<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    Described in [Ramsay JO, Silverman BW (2005) Functional data analysis.]</span>
<span class="sd">    Ported from SEEWAVE R Package</span>
<span class="sd">    &quot;&quot;&quot;</span>      
    
    <span class="k">if</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_axis&#39;</span> <span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> 
            <span class="n">m</span><span class="p">[</span><span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>    <span class="c1"># Avoid dividing by zero value</span>
            <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>
            <span class="k">elif</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span> <span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
            <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span> <span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">_MIN_</span>    <span class="c1"># Avoid dividing by zero value</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">m</span> 
            
    <span class="n">deriv2</span> <span class="o">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">deriv2</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">r</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="entropy"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.entropy.html#maad.ecoacoustics.alpha_indices.entropy">[docs]</a><span class="k">def</span> <span class="nf">entropy</span> <span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the entropy of a vector or matrix datain (i.e. waveform, spectrum...)    </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datain : ndarray of floats</span>
<span class="sd">        datain is a vector (1d) or a matrix (2d)</span>

<span class="sd">    axis : int, optional, default is 0</span>
<span class="sd">        select the axis where the entropy is computed</span>
<span class="sd">        if datain is a vector, axis=0</span>
<span class="sd">        if datain is a 2d ndarray, axis=0 =&gt; rows, axis=1 =&gt; columns</span>
<span class="sd">                </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    H : float or ndarray of floats</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">datain</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">axis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: x is empty&quot;</span><span class="p">)</span> 
                <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 
            <span class="k">elif</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null entropy</span>
            <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">H</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null entropy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if datain contains negative values -&gt; rescale the signal between </span>
                <span class="c1"># between posSitive values (for example (0,1))</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">datain</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">datain</span> <span class="o">=</span> <span class="n">linear_scale</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">minval</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maxval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1"># length of datain along axis</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
                <span class="c1"># Tranform the signal into a Probability mass function (pmf)</span>
                <span class="c1"># Sum(pmf) = 1</span>
                <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                    <span class="n">pmf</span> <span class="o">=</span> <span class="n">datain</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> 
                    <span class="n">pmf</span> <span class="o">=</span> <span class="p">(</span><span class="n">datain</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span><span class="n">axis</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">pmf</span><span class="p">[</span><span class="n">pmf</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_MIN_</span>
                <span class="c1">#normalized by the length : H=&gt;[0,1]</span>
                <span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">pmf</span><span class="o">*</span><span class="n">log</span><span class="p">(</span><span class="n">pmf</span><span class="p">),</span><span class="n">axis</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING :axis is greater than the dimension of the array&quot;</span><span class="p">)</span>    
            <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: type of datain must be ndarray&quot;</span><span class="p">)</span>   
        <span class="n">H</span> <span class="o">=</span> <span class="kc">None</span> 

    <span class="k">return</span> <span class="n">H</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="envelope"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.envelope.html#maad.ecoacoustics.alpha_indices.envelope">[docs]</a><span class="k">def</span> <span class="nf">envelope</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcul the envelope of a sound (1d) </span>
<span class="sd">    The sound is first divided into frames (2d) using the function </span>
<span class="sd">    wave2timeframes(wave), then the max of each frame gives a good approximation</span>
<span class="sd">    of the envelope.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    wave : ndarray of floats </span>
<span class="sd">        1d : sound waveform</span>
<span class="sd">        </span>
<span class="sd">    mode : str, optional, default is &quot;fast&quot;</span>
<span class="sd">        - &quot;fast&quot; : The sound is first divided into frames (2d) using the </span>
<span class="sd">            function wave2timeframes(wave), then the max of each frame gives a </span>
<span class="sd">            good approximation of the envelope.</span>
<span class="sd">        - &quot;Hilbert&quot; : estimation of the envelope from the Hilbert transform. </span>
<span class="sd">            The method is slow</span>
<span class="sd">    </span>
<span class="sd">    N : integer, optional, default is 512</span>
<span class="sd">        Size of each frame. The largest, the highest is the approximation.</span>
<span class="sd">                  </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    env : ndarray of floats</span>
<span class="sd">        Envelope of the sound (1d) </span>
<span class="sd">        </span>
<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    Fast calculation is inspired by the work of Towsey.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span> <span class="p">:</span>
        <span class="c1"># Envelope : take the median (instead of max as Towsey) of each frame</span>
        <span class="c1"># median gives more accurate result than max</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="n">wave2frames</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="n">env</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">frames</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span><span class="s1">&#39;hilbert&#39;</span> <span class="p">:</span>
        <span class="c1"># Compute the hilbert transform of the waveform and take the norm </span>
        <span class="c1"># (magnitude) </span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hilbert</span><span class="p">(</span><span class="n">wave</span><span class="p">))</span>  
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING : choose a mode between &#39;fast&#39; and &#39;hilbert&#39;&quot;</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">env</span></div>


<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="score"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.score.html#maad.ecoacoustics.alpha_indices.score">[docs]</a><span class="k">def</span> <span class="nf">score</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Score</span>

<span class="sd">    count the number of times values in x that are greater than the threshold </span>
<span class="sd">    and normalized by the total number of values in x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">        </span>
<span class="sd">    threshold : scalar</span>
<span class="sd">        Value &gt; threshold are counted    </span>
<span class="sd">        </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        score is calculated along this axis.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    count : scalar</span>
<span class="sd">        the number of times values in x that are greater than the threshold</span>
<span class="sd">    s : scalar</span>
<span class="sd">        count is normalized by the total number of values in x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">threshold</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="gini"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.gini.html#maad.ecoacoustics.alpha_indices.gini">[docs]</a><span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">corr</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gini</span>
<span class="sd">    </span>
<span class="sd">    Compute the Gini value of x</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">    </span>
<span class="sd">    corr : boolean, optional, default is False</span>
<span class="sd">        Correct the Gini value</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------  </span>
<span class="sd">    G: scalar</span>
<span class="sd">        Gini value</span>
<span class="sd">        </span>
<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    Ported from ineq library in R</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">G</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># null gini</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">G</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">G</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">corr</span> <span class="p">:</span> <span class="n">G</span> <span class="o">=</span> <span class="n">G</span><span class="o">/</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">G</span><span class="o">=</span> <span class="n">G</span><span class="o">/</span><span class="n">n</span>
    <span class="k">return</span> <span class="n">G</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="shannonEntropy"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.shannonEntropy.html#maad.ecoacoustics.alpha_indices.shannonEntropy">[docs]</a><span class="k">def</span> <span class="nf">shannonEntropy</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shannon Entropy</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    datain : ndarray of floats</span>
<span class="sd">        Vector or matrix containing the data</span>
<span class="sd">    </span>
<span class="sd">    axis : integer, optional, default is 0</span>
<span class="sd">        entropy is calculated along this axis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    Hs : ndarray of floats</span>
<span class="sd">        Vector or matrix of Shannon Entropy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># length of datain along axis</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">datain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="n">Hs</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">datain</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Hs</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticRichnessIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acousticRichnessIndex.html#maad.ecoacoustics.alpha_indices.acousticRichnessIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticRichnessIndex</span> <span class="p">(</span><span class="n">Ht_array</span><span class="p">,</span> <span class="n">M_array</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic richness index : AR</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Ht_array : 1d ndarray of floats</span>
<span class="sd">        Vector containing the temporal entropy Ht of the selected files </span>
<span class="sd">    </span>
<span class="sd">    M_array: 1d ndarray of floats</span>
<span class="sd">        Vector containing the amplitude index M  of the selected files </span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    AR : 1d ndarray of floats</span>
<span class="sd">        Vector of acoustic richenss index</span>
<span class="sd">        </span>
<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    Described in [Depraetere &amp; al. 2012]</span>
<span class="sd">    Ported from SEEWAVE R package</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">M_array</span><span class="p">)</span> <span class="p">:</span> 
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;warning : Ht_array and M_array must have the same length&quot;</span><span class="p">)</span>
    
    <span class="n">AR</span> <span class="o">=</span> <span class="n">rankdata</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span> <span class="o">*</span> <span class="n">rankdata</span><span class="p">(</span><span class="n">M_array</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ht_array</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">AR</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticComplexityIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acousticComplexityIndex.html#maad.ecoacoustics.alpha_indices.acousticComplexityIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticComplexityIndex</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Complexity Index : ACI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    norm : string, optional, default is &#39;global&#39;</span>
<span class="sd">        Determine if the ACI is normalized by the sum on the whole frequencies</span>
<span class="sd">        (&#39;global&#39; mode) or by the sum of frequency bin per frequency bin </span>
<span class="sd">        (&#39;per_bin&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ACI_xx : 2d ndarray of scalars</span>
<span class="sd">        Acoustic Complexity Index of the spectrogram</span>
<span class="sd">    </span>
<span class="sd">    ACI_per_bin : 1d ndarray of scalars</span>
<span class="sd">        ACI value for each frequency bin</span>
<span class="sd">        sum(ACI_xx,axis=1)</span>
<span class="sd">        </span>
<span class="sd">    ACI_sum : scalar</span>
<span class="sd">        Sum of ACI value per frequency bin (Common definition)</span>
<span class="sd">        sum(ACI_per_bin)</span>
<span class="sd">        </span>
<span class="sd">    ACI_mean ; scalar</span>
<span class="sd">        </span>
<span class="sd">        !!! pas de sens car non independant de la rÃ©solution freq et temporelle</span>
<span class="sd">        !!! Seulement sum donne un rÃ©sultat independant de N (pour la FFT)  </span>
<span class="sd">        !!! et donc de df et dt</span>
<span class="sd">        </span>
<span class="sd">    Reference</span>
<span class="sd">    ---------</span>
<span class="sd">    Pieretti N, Farina A, Morri FD (2011) A new methodology to infer the singing </span>
<span class="sd">    activity of an avian community: the Acoustic Complexity Index (ACI). </span>
<span class="sd">    Ecological Indicators, 11, 868-873.</span>
<span class="sd">    </span>
<span class="sd">    Ported from the Seewave R package.</span>
<span class="sd">    </span>
<span class="sd">    !!!!! in Seewave, the result is the sum of the ACI per bin.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>   
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_bin&#39;</span><span class="p">:</span>
        <span class="n">ACI_xx</span> <span class="o">=</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
        <span class="n">ACI_xx</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">Sxx</span><span class="p">))</span>

    <span class="n">ACI_per_bin</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ACI_xx</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ACI_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ACI_per_bin</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ACI_xx</span><span class="p">,</span> <span class="n">ACI_per_bin</span><span class="p">,</span> <span class="n">ACI_sum</span><span class="p">,</span> </div>

<div class="viewcode-block" id="surfaceRoughness"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.surfaceRoughness.html#maad.ecoacoustics.alpha_indices.surfaceRoughness">[docs]</a><span class="k">def</span> <span class="nf">surfaceRoughness</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span><span class="s1">&#39;global&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Surface Roughness </span>
<span class="sd">    see wikipedia : https://en.wikipedia.org/wiki/Surface_roughness</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram (i.e matrix of spectrum)</span>
<span class="sd">    </span>
<span class="sd">    norm : string, optional, default is &#39;global&#39;</span>
<span class="sd">        Determine if the ROUGHNESS is normalized by the sum on the whole frequencies</span>
<span class="sd">        (&#39;global&#39; mode) or by the sum of frequency bin per frequency bin </span>
<span class="sd">        (&#39;per_bin&#39;)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------        </span>
<span class="sd">    Ra_per_bin : 1d ndarray of scalars</span>
<span class="sd">        Arithmetical mean deviation from the mean line (global or per frequency bin)</span>
<span class="sd">        =&gt; ROUGHNESS value for each frequency bin</span>
<span class="sd">        </span>
<span class="sd">    Ra : scalar</span>
<span class="sd">        Arithmetical mean deviation from the mean line [mean (Ra_per_bin)]</span>
<span class="sd">        =&gt; mean ROUGHNESS value over Sxx </span>
<span class="sd">        </span>
<span class="sd">    Rq_per_bin : 1d ndarray of scalars</span>
<span class="sd">        Root mean squared of deviation from the mean line (global or per frequency bin)</span>
<span class="sd">        =&gt; RMS ROUGHNESS value for each frequency bin</span>
<span class="sd">        </span>
<span class="sd">    Rq : scalar</span>
<span class="sd">        Root mean squared of deviation from the mean line  [mean (Rq_per_bin)]</span>
<span class="sd">        =&gt; RMS ROUGHNESS value over Sxx </span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;per_bin&#39;</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">-</span><span class="n">m</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        
    <span class="k">elif</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;global&#39;</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">-</span><span class="n">m</span>

    <span class="c1"># Arithmetic mean deviation</span>
    <span class="n">Ra_per_bin</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ra</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Ra_per_bin</span><span class="p">)</span>

    <span class="n">Rq_per_bin</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">Rq</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Rq_per_bin</span><span class="p">)</span> 
    
    <span class="k">return</span> <span class="n">Ra_per_bin</span><span class="p">,</span> <span class="n">Rq_per_bin</span><span class="p">,</span> <span class="n">Ra</span><span class="p">,</span> <span class="n">Rq</span></div>


<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticDiversityIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acousticDiversityIndex.html#maad.ecoacoustics.alpha_indices.acousticDiversityIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticDiversityIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> 
                            <span class="n">dB_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;shannon&quot;</span><span class="p">,</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Diversity Index : ADI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    fmin : scalar, optional, default is 0</span>
<span class="sd">        Minimum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    fmax : scalar, optional, default is 20000</span>
<span class="sd">        Maximum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    bin_step : scalar, optional, default is 500</span>
<span class="sd">        Frequency step in Hz</span>
<span class="sd">    </span>
<span class="sd">    dB_threshold : scalar, optional, default is 3dB</span>
<span class="sd">        Threshold to compute the score (ie. the number of data &gt; threshold,</span>
<span class="sd">        normalized by the length)</span>
<span class="sd">        </span>
<span class="sd">    index : string, optional, default is &quot;shannon&quot;</span>
<span class="sd">        &quot;shannon&quot; : Shannon entropy is calculated on the vector of scores</span>
<span class="sd">        &quot;simpson&quot; : Simpson index is calculated on the vector of scores</span>
<span class="sd">        &quot;invsimpson&quot; : Inverse Simpson index is calculated on the vector </span>
<span class="sd">        of scores</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ADI : scalar </span>
<span class="sd">        Acoustic Diversity Index of the spectrogram (ie. index of the vector </span>
<span class="sd">        of scores)</span>
<span class="sd">    </span>
<span class="sd">    Reference</span>
<span class="sd">    --------</span>
<span class="sd">    Villanueva-Rivera, L. J., B. C. Pijanowski, J. Doucette, and B. Pekin. 2011. </span>
<span class="sd">    A primer of acoustic analysis for landscape ecologists. Landscape Ecology 26: 1233-1246.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># number of frequency intervals to compute the score</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">fmax</span><span class="o">-</span><span class="n">fmin</span><span class="p">)</span><span class="o">/</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="s1">&#39;soundecology&#39;</span> <span class="p">:</span>
        <span class="c1"># convert into dB and normalization by the max</span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="c1"># convert into dB </span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>         
    
    <span class="c1"># Score for each frequency in the frequency bandwith</span>
    <span class="n">s_sum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmin</span><span class="o">+</span><span class="n">bin_step</span><span class="o">*</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">bin_step</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">Sxx_dB</span><span class="p">[</span><span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,(</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)),:],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s_sum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s_sum</span><span class="p">)</span>
    
    <span class="c1"># Entropy</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span><span class="s2">&quot;shannon&quot;</span><span class="p">:</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="n">shannonEntropy</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;simpson&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">index</span> <span class="o">==</span> <span class="s2">&quot;invsimpson&quot;</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">ADI</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>   
    
    <span class="k">return</span> <span class="n">ADI</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="acousticEvenessIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acousticEvenessIndex.html#maad.ecoacoustics.alpha_indices.acousticEvenessIndex">[docs]</a><span class="k">def</span> <span class="nf">acousticEvenessIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">20000</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> 
                          <span class="n">dB_threshold</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Eveness Index : AEI</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx: ndarray of floats</span>
<span class="sd">        2d : Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    fmin : scalar, optional, default is 0</span>
<span class="sd">        Minimum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    fmax : scalar, optional, default is 20000</span>
<span class="sd">        Maximum frequency in Hz</span>
<span class="sd">        </span>
<span class="sd">    bin_step : scalar, optional, default is 500</span>
<span class="sd">        Frequency step in Hz</span>
<span class="sd">    </span>
<span class="sd">    dB_threshold : scalar, optional, default is -50</span>
<span class="sd">        Threshold to compute the score (ie. the number of data &gt; threshold,</span>
<span class="sd">        normalized by the length)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    AEI : scalar </span>
<span class="sd">        Acoustic Eveness of the spectrogram (ie. Gini of the vector of scores)</span>
<span class="sd">        </span>
<span class="sd">    Reference </span>
<span class="sd">    ---------</span>
<span class="sd">    Villanueva-Rivera, L. J., B. C. Pijanowski, J. Doucette, and B. Pekin. 2011. </span>
<span class="sd">    A primer of acoustic analysis for landscape ecologists. Landscape Ecology 26: 1233-1246.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># number of frequency intervals to compute the score</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">fmax</span><span class="o">-</span><span class="n">fmin</span><span class="p">)</span><span class="o">/</span><span class="n">bin_step</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="s1">&#39;soundecology&#39;</span> <span class="p">:</span>
        <span class="c1"># convert into dB and normalization by the max</span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="c1"># convert into dB </span>
        <span class="n">Sxx_dB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>   
    
    <span class="c1"># Score for each frequency in the frequency bandwith</span>
    <span class="n">s_sum</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fmin</span><span class="o">+</span><span class="n">bin_step</span><span class="o">*</span><span class="p">(</span><span class="n">ii</span><span class="p">))</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">bin_step</span><span class="p">)</span>
        <span class="n">s</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">Sxx_dB</span><span class="p">[</span><span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,(</span><span class="n">f0</span><span class="p">,</span><span class="n">f1</span><span class="p">)),:],</span> <span class="n">threshold</span><span class="o">=</span><span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">s_sum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    
    <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">s_sum</span><span class="p">)</span>
    
    <span class="c1"># Gini</span>
    <span class="n">AEI</span> <span class="o">=</span> <span class="n">gini</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">AEI</span></div>

<span class="c1">#=============================================================================</span>

<span class="c1">####    Indices based on the entropy</span>

<div class="viewcode-block" id="spectral_entropy"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.spectral_entropy.html#maad.ecoacoustics.alpha_indices.spectral_entropy">[docs]</a><span class="k">def</span> <span class="nf">spectral_entropy</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">frange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spectral entropy : EAS, ECU, ECV, EPS, </span>
<span class="sd">    </span>
<span class="sd">    + kurtosis and skewness : KURT, SKEW</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    X : ndarray of floats</span>
<span class="sd">        Spectrum (1d) or Spectrogram (2d). </span>
<span class="sd">        Better to use the PSD to be consistent with energy</span>
<span class="sd">    </span>
<span class="sd">    fn : 1d ndarray of floats</span>
<span class="sd">        frequency vector</span>
<span class="sd">    </span>
<span class="sd">    frange : tupple (fmin, fmax), optional, default is None</span>
<span class="sd">        Frequency band used to compute the spectral entropy.</span>
<span class="sd">        For instance, one may want to compute the spectral entropy for the </span>
<span class="sd">        biophony bandwidth</span>
<span class="sd">    </span>
<span class="sd">    display : boolean, optional, default is False</span>
<span class="sd">        Display the different spectra (mean, variance, covariance, max...)</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    EAS, ECU, ECV, EPS, KURT, SKEW : scalars </span>
<span class="sd">        EAS : Entropy of spectrum</span>
<span class="sd">        ECU : Entropy of spectral variance (along the time axis for each frequency)</span>
<span class="sd">        ECV : Entropy of coefficient of variance (along the time axis for each frequency)</span>
<span class="sd">        EPS : Entropy of spectral maxima </span>
<span class="sd">        KURT : Kurtosis of spectral maxima</span>
<span class="sd">        SKEW : Skewness of spectral maxima</span>
<span class="sd">        </span>
<span class="sd">    Reference </span>
<span class="sd">    ---------</span>
<span class="sd">    Credit : </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frange</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;WARNING: frange must be a tupple (fmin, fmax) or None&quot;</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="n">frange</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">frange</span><span class="o">=</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">fn</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    
    <span class="c1"># select the indices corresponding to the frequency range</span>
    <span class="n">iBAND</span> <span class="o">=</span> <span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">frange</span><span class="p">)</span>

    <span class="c1"># TOWSEY &amp; BUXTON : only on the bio band</span>
    <span class="c1"># EAS [TOWSEY] #</span>
     
    <span class="c1">####  COMMENT : Result a bit different due to different Hilbert implementation</span>
    
    <span class="n">X_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_mean</span><span class="p">)</span>
    <span class="n">EAS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf</span>

    <span class="c1">#### Entropy of spectral variance (along the time axis for each frequency)</span>
    <span class="sd">&quot;&quot;&quot; ECU [TOWSEY] &quot;&quot;&quot;</span>
    <span class="n">X_Var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf_var</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_Var</span><span class="p">)</span>
    <span class="n">ECU</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_var</span>

    <span class="c1">#### Entropy of coefficient of variance (along the time axis for each frequency)</span>
    <span class="sd">&quot;&quot;&quot; ECV [TOWSEY] &quot;&quot;&quot;</span>
    <span class="n">X_CoV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Hf_CoV</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">X_CoV</span><span class="p">)</span>
    <span class="n">ECV</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_CoV</span>
    
    <span class="c1">#### Entropy of spectral maxima </span>
    <span class="sd">&quot;&quot;&quot; EPS [TOWSEY]  &quot;&quot;&quot;</span>
    <span class="n">ioffset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">iBAND</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Nbins</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">iBAND</span><span class="o">==</span><span class="kc">True</span><span class="p">)</span>    
    <span class="n">imax_X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">ioffset</span>
    <span class="n">imax_X</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="n">imax_X</span><span class="p">]</span>
    <span class="n">max_X_bin</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">imax_X</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">Nbins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">frange</span><span class="p">)</span>
    <span class="n">max_X_bin</span> <span class="o">=</span> <span class="n">max_X_bin</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    <span class="n">Hf_fmax</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    <span class="n">EPS</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Hf_fmax</span>    
    
    <span class="c1">#### Kurtosis of spectral maxima</span>
    <span class="n">KURT</span> <span class="o">=</span> <span class="n">kurtosis</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    
    <span class="c1">#### skewness of spectral maxima</span>
    <span class="n">SKEW</span> <span class="o">=</span> <span class="n">skewness</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">display</span><span class="p">:</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_mean</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_mean</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized mean Axx&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_Var</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_Var</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized variance Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">X_CoV</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">X_CoV</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized covariance Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="n">iBAND</span><span class="p">],</span> <span class="n">max_X_bin</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">max_X_bin</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Normalized Spectral max Axx&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Signals&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">EAS</span><span class="p">,</span> <span class="n">ECU</span><span class="p">,</span> <span class="n">ECV</span><span class="p">,</span> <span class="n">EPS</span><span class="p">,</span> <span class="n">KURT</span><span class="p">,</span> <span class="n">SKEW</span></div>


<span class="c1">#=============================================================================</span>

<span class="c1">####    Indices based on the energy</span>

    
<span class="k">def</span> <span class="nf">_energy_per_freqbin</span> <span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">frange</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20000</span><span class="p">),</span> <span class="n">bin_step</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        
    <span class="c1">#Convert into bins</span>
    <span class="n">PSDxx_bins</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">intoBins</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">bin_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bin_max</span><span class="o">=</span><span class="n">fn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                              <span class="n">bin_step</span><span class="o">=</span><span class="n">bin_step</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">indf</span> <span class="o">=</span> <span class="n">index_bw</span> <span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">frange</span><span class="p">)</span> 

    <span class="c1"># select the frequency bins and take the min</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">PSDxx_bins</span><span class="p">[</span><span class="n">indf</span><span class="p">,</span> <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">energy</span>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="soundscapeIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.soundscapeIndex.html#maad.ecoacoustics.alpha_indices.soundscapeIndex">[docs]</a><span class="k">def</span> <span class="nf">soundscapeIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span><span class="n">fn</span><span class="p">,</span><span class="n">frange_bioPh</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10000</span><span class="p">),</span><span class="n">frange_antroPh</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> 
                     <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    soundscapeIndex</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        2d : Amplitude Spectrogram</span>
<span class="sd">    </span>
<span class="sd">    fn : vector</span>
<span class="sd">        frequency vector </span>
<span class="sd">        </span>
<span class="sd">    frange_bioPh : tupple (fmin, fmax), optional, default is (1000,10000)</span>
<span class="sd">        Frequency band of the biophony</span>
<span class="sd">    </span>
<span class="sd">    frange_antroPh: tupple (fmin, fmax), optional, default is (0,1000)</span>
<span class="sd">        Frequency band of the anthropophony</span>
<span class="sd">    </span>
<span class="sd">    step: optional, default is None</span>
<span class="sd">        if step is None, keep the original frequency resolution, otherwise,</span>
<span class="sd">        the spectrogram is converted into new frequency bins</span>
<span class="sd">        </span>
<span class="sd">    Returns :</span>
<span class="sd">    ---------</span>
<span class="sd">    NDSI : scalar</span>
<span class="sd">        (bioPh-antroPh)/(bioPh+antroPh)</span>
<span class="sd">    ratioBA : scalar</span>
<span class="sd">        biophonic energy / anthropophonic energy</span>
<span class="sd">    antroPh : scalar</span>
<span class="sd">        Acoustic energy in the anthropophonic bandwidth</span>
<span class="sd">    bioPh : scalar</span>
<span class="sd">        Acoustic energy in the biophonic bandwidth</span>
<span class="sd">    </span>
<span class="sd">    Reference :</span>
<span class="sd">    -----------</span>
<span class="sd">    Kasten, Eric P., Stuart H. Gage, Jordan Fox, and Wooyeong Joo. 2012. </span>
<span class="sd">    The Remote Environmental Assessment Laboratory&#39;s Acoustic Library: An Archive </span>
<span class="sd">    for Studying Soundscape Ecology. Ecological Informatics 12: 50-67.</span>
<span class="sd">    </span>
<span class="sd">    Inspired by Seewave R package</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Frequency resolution</span>
    <span class="c1"># if step is None, keep the original frequency resolution, otherwise,</span>
    <span class="c1"># the spectrogram is converted into new frequency bins</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Convert Sxx (amplitude) into PSDxx (energy)</span>
    <span class="n">PSDxx</span> <span class="o">=</span> <span class="n">Sxx</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># Energy in BIOBAND</span>
    <span class="n">bioPh</span> <span class="o">=</span> <span class="n">_energy_per_freqbin</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">frange</span><span class="o">=</span><span class="n">frange_bioPh</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="c1"># Energy in ANTHROPOBAND</span>
    <span class="n">antroPh</span> <span class="o">=</span> <span class="n">_energy_per_freqbin</span><span class="p">(</span><span class="n">PSDxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">frange</span><span class="o">=</span><span class="n">frange_antroPh</span><span class="p">,</span> <span class="n">bin_step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    
    <span class="c1"># NDSI and ratioBA indices </span>
    <span class="n">NDSI</span> <span class="o">=</span> <span class="p">(</span><span class="n">bioPh</span><span class="o">-</span><span class="n">antroPh</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">bioPh</span><span class="o">+</span><span class="n">antroPh</span><span class="p">)</span>
    <span class="n">ratioBA</span> <span class="o">=</span> <span class="n">bioPh</span> <span class="o">/</span> <span class="n">antroPh</span>
    
    <span class="k">return</span> <span class="n">NDSI</span><span class="p">,</span> <span class="n">ratioBA</span><span class="p">,</span> <span class="n">antroPh</span><span class="p">,</span> <span class="n">bioPh</span></div>

<span class="c1">#=============================================================================</span>
<div class="viewcode-block" id="bioacousticsIndex"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.bioacousticsIndex.html#maad.ecoacoustics.alpha_indices.bioacousticsIndex">[docs]</a><span class="k">def</span> <span class="nf">bioacousticsIndex</span> <span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">frange</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">),</span> <span class="n">R_compatible</span> <span class="o">=</span> <span class="s1">&#39;soundecology&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bioacoustics Index</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Sxx : ndarray of floats</span>
<span class="sd">        matrix : Spectrogram  </span>
<span class="sd">    </span>
<span class="sd">    fn : vector</span>
<span class="sd">        frequency vector </span>
<span class="sd">    </span>
<span class="sd">    frange : tupple (fmin, fmax), optional, default is (2000, 15000)</span>
<span class="sd">        Frequency band used to compute the bioacoustic index.</span>
<span class="sd">        </span>
<span class="sd">    R_compatible : Boolean, optional, default is False</span>
<span class="sd">        if True, the result is similar to the package SoundEcology in R but </span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    BI : scalar</span>
<span class="sd">        Bioacoustics Index</span>
<span class="sd">    </span>
<span class="sd">    Reference </span>
<span class="sd">    ---------</span>
<span class="sd">    Reference: Boelman NT, Asner GP, Hart PJ, Martin RE. 2007. Multi-trophic </span>
<span class="sd">    invasion resistance in Hawaii: bioacoustics, field surveys, and airborne </span>
<span class="sd">    remote sensing. Ecological Applications 17: 2137-2144.</span>
<span class="sd">    </span>
<span class="sd">    Ported and modified from the soundecology R package.</span>
<span class="sd">    </span>
<span class="sd">    Erratum</span>
<span class="sd">    -------</span>
<span class="sd">    Soundecology compatible version</span>
<span class="sd">        - average of dB value</span>
<span class="sd">        - remove negative value in order to get positive values only</span>
<span class="sd">        - dividing by the frequency resolution df instead of multiplication</span>
<span class="sd">        ...</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    
    <span class="c1"># select the indices corresponding to the frequency bins range</span>
    <span class="n">indf</span> <span class="o">=</span> <span class="n">index_bw</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">frange</span><span class="p">)</span>
    
    <span class="c1"># frequency resolution. </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">fn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># ======= As soundecology</span>
    <span class="k">if</span> <span class="n">R_compatible</span> <span class="o">==</span> <span class="s1">&#39;soundecology&#39;</span> <span class="p">:</span>
        <span class="c1"># Mean Sxx normalized by the max</span>
        <span class="n">meanSxx</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Convert into dB</span>
        <span class="n">meanSxxdB</span> <span class="o">=</span> <span class="n">linear2dB</span><span class="p">(</span><span class="n">meanSxx</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span>
        
        <span class="c1"># &quot;normalization&quot; in order to get positive &#39;vectical&#39; values </span>
        <span class="n">meanSxxdB</span> <span class="o">=</span> <span class="n">meanSxxdB</span><span class="p">[</span><span class="n">indf</span><span class="p">,]</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">meanSxxdB</span><span class="p">[</span><span class="n">indf</span><span class="p">,])</span>
    
        <span class="c1"># this is not the area under the curve...</span>
        <span class="c1"># what is the meaning of an area under the curve in dB...</span>
        <span class="n">BI</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">meanSxxdB</span><span class="p">)</span><span class="o">/</span><span class="n">df</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># normalize by the max of the spectrogram</span>
        <span class="c1"># better to average the PSD for energy conservation</span>
        <span class="n">PSDxx_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">Sxx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">meanPSDxx_norm</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">PSDxx_norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Compute the area</span>
        <span class="c1"># take the sqrt in order to go back to Sxx</span>
        <span class="n">BI</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">meanPSDxx_norm</span><span class="p">))</span><span class="o">*</span> <span class="n">df</span> 
        
    <span class="k">return</span> <span class="n">BI</span></div>
    

<span class="c1">####    Indices based on the acoustic event  ####</span>
    


<div class="viewcode-block" id="acoustic_activity"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acoustic_activity.html#maad.ecoacoustics.alpha_indices.acoustic_activity">[docs]</a><span class="k">def</span> <span class="nf">acoustic_activity</span> <span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic Activity :</span>
<span class="sd">    </span>
<span class="sd">    for each frequency bin :</span>
<span class="sd">    - ACTfract : proportion (fraction) of points above the threshold </span>
<span class="sd">    - ACTcount : number of points above the threshold</span>
<span class="sd">    - ACTmean : mean value (in dB) of the portion of the signal above the threhold</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xdB : ndarray of floats</span>
<span class="sd">        1d : envelope in dB</span>
<span class="sd">        2d : PSD spectrogram in dB</span>
<span class="sd">        It&#39;s better to work with PSD or envelope without background variation</span>
<span class="sd">        as the process is based on threshold.</span>

<span class="sd">    dt : scalar</span>
<span class="sd">        Time resolution</span>

<span class="sd">    dB_threshold : scalar, optional, default is 6dB</span>
<span class="sd">        data &gt;Threshold is considered to be an event </span>
<span class="sd">        if the length is &gt; rejectLength</span>
<span class="sd">        </span>
<span class="sd">    rejectDuration : scalar, optional, default is None</span>
<span class="sd">        event shorter than rejectDuration are discarded</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    ACTfract :ndarray of scalars</span>
<span class="sd">        proportion (fraction) of points above the threshold for each frequency bin</span>
<span class="sd">    ACTcount: ndarray of scalars</span>
<span class="sd">        number of points above the threshold for each frequency bin</span>
<span class="sd">    ACTmean: scalar</span>
<span class="sd">        mean value (in dB) of the portion of the signal above the threhold</span>
<span class="sd">        </span>
<span class="sd">    Reference </span>
<span class="sd">    ---------</span>
<span class="sd">    Towsey, Michael W. (2013) Noise removal from wave-forms and spectrograms derived </span>
<span class="sd">    from natural recordings of the environment.</span>
<span class="sd">    Towsey, Michael (2013), Noise Removal from Waveforms and Spectrograms Derived </span>
<span class="sd">    from Natural Recordings of the Environment. Queensland University of Technology, Brisbane.</span>
<span class="sd">    </span>
<span class="sd">    ACTsp [Towsey] : ACTfract (proportion (fraction) of point value above the theshold)</span>
<span class="sd">    EVNsp [Towsey] : ACTcount (number of point value above the theshold)</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">ACTfract</span><span class="p">,</span> <span class="n">ACTcount</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">ACTfract</span><span class="o">=</span> <span class="n">ACTfract</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ACTcount</span> <span class="o">=</span> <span class="n">ACTcount</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">ACTmean</span> <span class="o">=</span> <span class="n">dB2linear</span><span class="p">(</span><span class="n">xdB</span><span class="p">[</span><span class="n">xdB</span><span class="o">&gt;</span><span class="n">dB_threshold</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ACTfract</span><span class="p">,</span> <span class="n">ACTcount</span><span class="p">,</span> <span class="n">ACTmean</span></div>
       

<span class="c1">#=============================================================================     </span>
<div class="viewcode-block" id="acoustic_events"><a class="viewcode-back" href="../../../_autosummary/maad.ecoacoustics.alpha_indices.acoustic_events.html#maad.ecoacoustics.alpha_indices.acoustic_events">[docs]</a><span class="k">def</span> <span class="nf">acoustic_events</span><span class="p">(</span><span class="n">xdB</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dB_threshold</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">rejectDuration</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Acoustic events :</span>
<span class="sd">            - EVNsum : total events duration (s) </span>
<span class="sd">            - EVNmean : mean events duration (s)</span>
<span class="sd">            - EVNcount : number of events per s</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xdB : ndarray of floats</span>
<span class="sd">        2d : Spectrogram  in dB</span>

<span class="sd">    dt : scalar</span>
<span class="sd">        Time resolution</span>

<span class="sd">    dB_threshold : scalar, optional, default is 6dB</span>
<span class="sd">        data &gt;Threshold is considered to be an event </span>
<span class="sd">        if the length is &gt; rejectLength</span>
<span class="sd">        </span>
<span class="sd">    rejectDuration : scalar, optional, default is None</span>
<span class="sd">        event shorter than rejectDuration are discarded</span>
<span class="sd">        duration is in s</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------    </span>
<span class="sd">    EVNsum :scalar</span>
<span class="sd">    EVNmean: scalar</span>
<span class="sd">    EVNcount: scalar</span>
<span class="sd">    EVN: ndarray of floats </span>

<span class="sd">    Reference </span>
<span class="sd">    ---------</span>
<span class="sd">    Towsey, Michael W. (2013) Noise removal from wave-forms and spectrograms derived </span>
<span class="sd">    from natural recordings of the environment.</span>
<span class="sd">    Towsey, Michael (2013), Noise Removal from Waveforms and Spectrograms Derived </span>
<span class="sd">    from Natural Recordings of the Environment. Queensland University of Technology, Brisbane.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># total duration</span>
    <span class="k">if</span> <span class="n">xdB</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">1</span> <span class="p">:</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xdB</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="k">if</span> <span class="n">xdB</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span><span class="mi">2</span> <span class="p">:</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
    
    <span class="n">xdB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xdB</span><span class="p">)</span>
    <span class="c1"># thresholding =&gt; binary</span>
    <span class="n">EVN</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdB</span><span class="o">&gt;=</span><span class="n">dB_threshold</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span>  
    <span class="c1"># Remove events shorter than &#39;rejectLength&#39; </span>
    <span class="c1"># (done by erosion+dilation = opening)</span>
    <span class="k">if</span> <span class="n">rejectDuration</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rejectLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">rejectDuration</span> <span class="o">/</span> <span class="n">dt</span><span class="p">))</span>
        <span class="c1"># tricks. Depending on the dimension of bin_x </span>
        <span class="c1"># if bin_x is a vector</span>
        <span class="k">if</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rejectLength</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># if bin_x is a matrix</span>
        <span class="k">elif</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">kernel</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rejectLength</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>  
        <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xdB must be a vector or a matrix&quot;</span><span class="p">)</span>
        <span class="c1"># Morphological tool : Opening</span>
        <span class="n">EVN</span> <span class="o">=</span> <span class="n">binary_erosion</span><span class="p">(</span><span class="n">EVN</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span>
        <span class="n">EVN</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">EVN</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">kernel</span><span class="p">)</span> 
    
    <span class="c1"># Extract the characteristics of each event : </span>
    <span class="c1"># duration (mean and sum in s) and count</span>
    <span class="k">if</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span>
        <span class="n">EVNsum</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EVNmean</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">EVNcount</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">EVN</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rle</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span> <span class="p">:</span>
                <span class="c1"># mean events duration in s</span>
                <span class="n">EVNmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">EVNmean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    
            <span class="c1"># total events duration in s </span>
            <span class="n">EVNsum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            <span class="c1"># number of events</span>
            <span class="n">EVNcount</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">/</span> <span class="n">duration</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">EVN</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">rle</span><span class="p">(</span><span class="n">EVN</span><span class="p">)</span> 
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span><span class="mi">0</span> <span class="p">:</span>
            <span class="c1"># mean events duration in s</span>
            <span class="n">EVNmean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">EVNmean</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># total events duration in s </span>
        <span class="n">EVNsum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">v</span><span class="o">==</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="c1"># number of events per s</span>
        <span class="n">EVNcount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">duration</span>
    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xdB must be a vector or a matrix&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">EVNsum</span><span class="p">,</span> <span class="n">EVNmean</span><span class="p">,</span> <span class="n">EVNcount</span><span class="p">,</span> <span class="n">EVN</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, scikit-maad development team.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>